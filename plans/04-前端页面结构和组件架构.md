# CS2 地图 Ban Pick 工具 - 前端页面结构和组件架构

## 1. 前端技术栈

| 技术 | 版本 | 说明 |
|------|------|------|
| Vue.js | 3.4+ | 渐进式 JavaScript 框架 |
| Vite | 5.0+ | 新一代前端构建工具 |
| Pinia | 2.1+ | Vue 3 官方状态管理库 |
| Vue Router | 4.2+ | Vue.js 官方路由管理器 |
| TailwindCSS | 3.4+ | 原子化 CSS 框架 |
| Socket.io-client | 4.6+ | WebSocket 客户端库 |
| Axios | 1.6+ | HTTP 请求库 |

## 2. 页面结构

### 2.1 页面路由

```mermaid
graph TD
    A[/] --> B{已登录?}
    B -->|否| C[JoinRoom.vue]
    B -->|是| D[WaitingRoom.vue]
    C --> E[SelectTeam.vue]
    E --> F[InputName.vue]
    F --> D
    D --> G{BP开始?}
    G -->|否| D
    G -->|是| H[BPProcess.vue]
    H --> I{BP结束?}
    I -->|否| H
    I -->|是| J[BPResult.vue]
    K[/admin] --> L{已登录?}
    L -->|否| M[AdminLogin.vue]
    L -->|是| N[AdminDashboard.vue]
```

### 2.2 页面列表

| 页面路径 | 组件名称 | 说明 |
|---------|---------|------|
| `/` | JoinRoom.vue | 加入房间页面（输入房间码） |
| `/team-select` | SelectTeam.vue | 选择队伍页面 |
| `/input-name` | InputName.vue | 输入用户名称页面 |
| `/waiting` | WaitingRoom.vue | 等待准备页面 |
| `/bp-process` | BPProcess.vue | BP 流程页面 |
| `/result` | BPResult.vue | BP 结果展示页面 |
| `/admin` | AdminLogin.vue | 管理员登录页面 |
| `/admin/dashboard` | AdminDashboard.vue | 管理员后台 |

## 3. 组件架构

### 3.1 组件层级结构

```
App.vue
├── Layout.vue (公共布局)
│   ├── Header.vue (顶部导航)
│   ├── Main.vue (主内容区)
│   └── Footer.vue (底部信息)
│
├── JoinRoom.vue
│   ├── RoomCodeInput.vue
│   └── JoinButton.vue
│
├── SelectTeam.vue
│   ├── TeamCard.vue
│   └── TeamIcon.vue
│
├── InputName.vue
│   ├── NameInput.vue
│   └── ConfirmButton.vue
│
├── WaitingRoom.vue
│   ├── TeamDisplay.vue
│   ├── UserList.vue
│   ├── ReadyButton.vue
│   └── ChatBox.vue
│
├── BPProcess.vue
│   ├── BPHeader.vue
│   │   ├── ProgressBar.vue
│   │   ├── PhaseText.vue
│   │   └── Timer.vue
│   ├── BPMain.vue
│   │   ├── TeamDisplay.vue (左侧)
│   │   ├── BPMapPolygon.vue (中间)
│   │   └── TeamDisplay.vue (右侧)
│   └── ChatBox.vue (底部)
│
├── BPResult.vue
│   ├── ResultHeader.vue
│   ├── ResultGrid.vue
│   └── RollResult.vue
│
└── AdminDashboard.vue
    ├── AdminSidebar.vue
    ├── RoomList.vue
    ├── RoomDetail.vue
    ├── MapPoolEditor.vue
    └── BPRecordViewer.vue
```

### 3.2 核心组件详解

#### 3.2.1 BPMapPolygon.vue（正七边形地图池组件）

这是项目最核心的组件，负责展示地图池状态和处理用户交互。

**Props：**
```typescript
interface MapCard {
  id: string;           // map01 ~ map07
  name: string;         // 地图名称（4个字）
  icon: string;          // 地图图标URL
  status: 'available' | 'banned' | 'picked' | 'decider';
  pickedBy?: string;     // PICKED BY [Team]
  bannedBy?: string;    // BANED BY [Team]
  order?: number;       // 1st/2nd/3rd
  isCurrent?: boolean;   // 是否为当前可选地图
  teammateIntent?: string; // 队友意向
}

interface Props {
  maps: MapCard[];
  currentPhase: number;  // 当前阶段 1-7
  canOperate: boolean;   // 当前用户是否可操作
  isMyTurn: boolean;     // 是否为当前用户回合
}
```

**Emits：**
```typescript
emit('ban-map', mapId: string);
emit('pick-map', mapId: string);
```

**UI 设计：**

```
        [禁用] 0/1 [地图]
           /        \
          /          \
     [方框1]      [方框7]
      map01        map07
    ┌────────┐    ┌────────┐
    │ ┌────┐ │    │ ┌────┐ │
    │ │ 图 │ │    │ │ 图 │ │
    │ │ 标 │ │    │ │ 标 │ │
    │ └────┘ │    │ └────┘ │
    │ 地图名 │    │ 地图名 │
    │[队友]  │    │ [队友] │
    └────────┘    └────────┘
     /              \
    /                \
[方框2]          [方框6]
 map02            map06
...              ...
```

**状态样式：**

| 状态 | 背景色 | 边框 | 文字 | 顶部标签 |
|------|-------|------|------|---------|
| available | 正常 | 无 | 白色 | 无 |
| banned | 灰色(20%亮度) | 红色方框 | 白色"禁用" | BANED BY [Team] |
| picked | 高亮 | 绿色方框 | 白色"√" | 1st/2nd - PICKED BY [Team] |
| decider | 高亮 | 黄色边框 | 白色 | 3rd - DECIDER |
| current可选 | 虚线框(20%亮度) | 无 | 白色 | 无 |

#### 3.2.2 ProgressBar.vue（进度条组件）

**Props：**
```typescript
interface Props {
  currentPhase: number;  // 1-7
  phaseProgress: number; // 0-100 当前阶段进度
  remainingTime?: number; // 剩余秒数
}
```

**UI 设计：**

```
┌─────────────────────────────────────────────────────────┐
│  禁用1张地图  |  禁用1张地图  |  选择1张地图  | ...     │
│  [████████]  |  [████░░░░]  |  [░░░░░░░░]  | ...     │
│      12s      │              │              │         │
└─────────────────────────────────────────────────────────┘
```

#### 3.2.3 TeamDisplay.vue（队伍展示组件）

**Props：**
```typescript
interface User {
  id: string;
  display_name: string;
  is_ready?: boolean;
}

interface Props {
  teamName: string;
  teamIcon: string;
  users: User[];
  isLeft?: boolean;  // 是否为左侧队伍
  isCurrentTeam?: boolean; // 是否为当前操作队伍
}
```

**UI 设计：**

```
┌─────────────────┐
│  [图标] Team A  │
├─────────────────┤
│  Player1        │
│  Player2        │
│  Player3        │
│  Player4        │
│  Player5        │
├─────────────────┤
│  [聊天输入框]   │
└─────────────────┘
```

#### 3.2.4 Timer.vue（计时器组件）

**Props：**
```typescript
interface Props {
  remainingTime: number;  // 剩余秒数
  totalTime: number;      // 总时间（15秒）
}
```

**UI 设计：**

```
   ┌─────────┐
   │   12    │
   │ 秒      │
   └─────────┘
```

#### 3.2.5 ChatBox.vue（聊天框组件）

**Props：**
```typescript
interface Message {
  team: string;
  user_name: string;
  content: string;
  timestamp: string;
}

interface Props {
  messages: Message[];
  myTeam: string;
}
```

**Emits：**
```typescript
emit('send-message', content: string);
```

**UI 设计：**

```
┌─────────────────────────────┐
│ [TeamA] Player1: Hello!     │
│ [TeamA] Player2: Let's go!  │
│ [TeamA] Player3: OK         │
│                             │
│                             │
├─────────────────────────────┤
│ [输入消息...]          [发送]│
└─────────────────────────────┘
```

#### 3.2.6 BPResult.vue（BP结果展示组件）

**Props：**
```typescript
interface ResultMap {
  id: string;
  name: string;
  icon: string;
  type: 'banned' | 'picked' | 'decider';
  team?: string;
  order: number;
}

interface Props {
  results: ResultMap[];
  teamA: { name: string; icon: string };
  teamB: { name: string; icon: string };
  rollResult: { rollA: number; rollB: number };
}
```

**UI 设计：**

```
┌─────────────────────────────────────────────────────────┐
│  Team A [图标]               Team B [图标]              │
│  Roll: 45                    Roll: 78                   │
├─────────────────────────────────────────────────────────┤
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ...   │
│  │ 图   │ │ 图   │ │ 图   │ │ 图   │ │ 图   │       │
│  │ 标   │ │ 标   │ │ 标   │ │ 标   │ │ 标   │       │
│  ├──────┤ ├──────┤ ├──────┤ ├──────┤ ├──────┤       │
│  │BANED │ │BANED │ │PICKED│ │PICKED│ │BANED │       │
│  │BY A  │ │BY B  │ │BY A  │ │BY B  │ │BY A  │       │
│  ├──────┤ ├──────┤ ├──────┤ ├──────┤ ├──────┤       │
│  │地图名│ │地图名│ │地图名│ │地图名│ │地图名│       │
│  └──────┘ └──────┘ └──────┘ └──────┘ └──────┘       │
│       (50%亮度)       (正常)       (50%亮度)          │
├─────────────────────────────────────────────────────────┤
│  ┌──────┐                                             │
│  │ 图   │                                             │
│  │ 标   │                                             │
│  ├──────┤                                             │
│  │DECIDER│                                            │
│  ├──────┤                                             │
│  │地图名│                                             │
│  └──────┘                                             │
└─────────────────────────────────────────────────────────┘
```

## 4. Pinia 状态管理

### 4.1 Room Store

```typescript
interface RoomState {
  roomId: string | null;
  roomCode: string | null;
  teamA: { name: string; icon: string };
  teamB: { name: string; icon: string };
  status: 'waiting' | 'rolling' | 'ban1' | 'ban2' | 'pick1' | 'decider' | 'finished';
  mappool: MapPoolConfig;
  users: { team_a: User[]; team_b: User[] };
}
```

**Actions：**
- `joinRoom(roomCode: string)`
- `selectTeam(team: string)`
- `updateUser(sessionId: string, userData: Partial<User>)`
- `updateRoomStatus(status: string)`
- `reset()`

### 4.2 User Store

```typescript
interface UserState {
  sessionId: string;
  userId: string | null;
  team: string | null;
  displayName: string | null;
  isReady: boolean;
}
```

**Actions：**
- `setSessionId(sessionId: string)`
- `setTeam(team: string)`
- `setDisplayName(name: string)`
- `setReady(ready: boolean)`
- `reset()`

### 4.3 BP Store

```typescript
interface BPState {
  phase: number;  // 1-7
  currentTeam: string | null;
  currentUser: string | null;
  remainingTime: number;
  maps: MapCard[];
  rollResult: { rollA: number; rollB: number } | null;
  result: BPResult | null;
}
```

**Actions：**
- `startBP(rollResult: RollResult)`
- `updatePhase(phase: number)`
- `banMap(mapId: string, team: string, userName: string)`
- `pickMap(mapId: string, team: string, userName: string)`
- `setDecider(mapId: string)`
- `updateTimer(time: number)`
- `reset()`

### 4.4 Chat Store

```typescript
interface ChatState {
  messages: Message[];
}
```

**Actions：**
- `addMessage(message: Message)`
- `clear()`

## 5. WebSocket 服务

```typescript
class SocketService {
  private socket: Socket | null = null;

  connect(roomId: string, sessionId: string): void;
  disconnect(): void;

  // 事件监听
  onUserJoined(callback: (data: any) => void): void;
  onUserLeft(callback: (data: any) => void): void;
  onTeamUpdated(callback: (data: any) => void): void;
  onBPStarted(callback: (data: any) => void): void;
  onBPPhaseChanged(callback: (data: any) => void): void;
  onMapBanned(callback: (data: any) => void): void;
  onMapPicked(callback: (data: any) => void): void;
  onTimerTick(callback: (data: any) => void): void;
  onChatMessage(callback: (data: any) => void): void;
  onBPFinished(callback: (data: any) => void): void;

  // 发送事件
  emitJoinRoom(roomId: string, sessionId: string): void;
  emitSelectTeam(roomId: string, sessionId: string, team: string): void;
  emitUpdateName(roomId: string, sessionId: string, displayName: string): void;
  emitReady(roomId: string, sessionId: string, isReady: boolean): void;
  emitBanMap(roomId: string, sessionId: string, mapId: string): void;
  emitPickMap(roomId: string, sessionId: string, mapId: string): void;
  emitSendChat(roomId: string, sessionId: string, content: string): void;
}
```

## 6. API 服务

```typescript
class APIService {
  // 房间相关
  getRoomByCode(roomCode: string): Promise<Room>;
  joinRoom(roomId: string, data: JoinRoomRequest): Promise<User>;
  updateReady(roomId: string, data: ReadyRequest): Promise<void>;
  getRoomUsers(roomId: string): Promise<UsersResponse>;

  // BP相关
  startBP(roomId: string): Promise<BPStartResponse>;
  getBPStatus(roomId: string): Promise<BPStatusResponse>;

  // 管理员相关
  adminLogin(data: LoginRequest): Promise<LoginResponse>;
  createMapPool(data: CreateMapPoolRequest): Promise<MapPoolConfig>;
  getMapPools(): Promise<MapPoolConfig[]>;
  createRoom(data: CreateRoomRequest): Promise<Room>;
  getRooms(params: GetRoomsParams): Promise<RoomsResponse>;
  getRoomDetail(roomId: string): Promise<RoomDetail>;
  getBPRecord(roomId: string): Promise<BPRecord>;
}
```

## 7. 样式规范

### 7.1 颜色定义

```css
:root {
  /* 主色调 */
  --color-primary: #f59e0b;  /* CS2 橙色 */
  --color-secondary: #3b82f6; /* 蓝色 */

  /* 状态颜色 */
  --color-success: #10b981;  /* 绿色 - Pick */
  --color-danger: #ef4444;   /* 红色 - Ban */
  --color-warning: #f59e0b;  /* 黄色 - Decider */

  /* 文字颜色 */
  --color-text-primary: #ffffff;
  --color-text-secondary: #9ca3af;

  /* 背景颜色 */
  --color-bg-primary: #1f2937;
  --color-bg-secondary: #111827;
  --color-bg-tertiary: #374151;
}
```

### 7.2 字体规范

```css
:root {
  --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --font-size-base: 16px;
  --font-size-lg: 18px;
  --font-size-xl: 20px;
  --font-size-2xl: 24px;
  --font-size-3xl: 30px;
}
```

## 8. 响应式设计

| 断点 | 宽度 | 说明 |
|------|------|------|
| sm | 640px | 手机横屏 |
| md | 768px | 平板 |
| lg | 1024px | 小型笔记本 |
| xl | 1280px | 桌面 |
| 2xl | 1536px | 大屏幕 |

## 9. 性能优化

1. **组件懒加载**：使用 Vue Router 的路由级代码分割
2. **图片优化**：使用 WebP 格式，设置合适的尺寸
3. **虚拟滚动**：聊天消息列表使用虚拟滚动
4. **防抖节流**：搜索和输入使用防抖，滚动事件使用节流
5. **缓存策略**：静态资源使用浏览器缓存

## 10. 错误处理

1. **全局错误捕获**：使用 Vue 的 errorHandler
2. **API 错误处理**：统一的错误拦截器
3. **WebSocket 重连**：自动重连机制
4. **用户提示**：使用 Toast 组件展示错误信息
